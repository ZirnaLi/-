工资查询与管理系统

这是一个基于 Python + PyQt5 + SQLite3 的桌面应用程序，用于实现工资查询与管理的功能。该程序支持管理员和普通用户两种角色，可以对工资信息进行增删改查、从 Excel/CSV 导入、以及导出为 PDF 等操作。

功能概述
用户登录/注册

支持普通用户注册；
系统内置默认管理员账号：用户名：管理员，密码：admin；
支持“忘记密码”功能，需管理员身份验证方可重置。
数据管理

使用 SQLite3 作为本地数据库，数据结构简单；
可以为每条工资记录设置多项字段：姓名、点数、基本奖、CT、DX、MR科研、值班补助等；
支持管理员对数据进行增删改查；
普通用户登录后，仅能查询其名下的数据（username 与姓名绑定）。

导入/导出功能

支持导入 Excel（.xlsx/.xls）或 CSV（.csv）格式的数据；
数据导入时，自动根据列名匹配并插入数据库；
支持导出为 PDF，便于存档与打印。

筛选与搜索

年、月筛选；
管理员可根据姓名搜索或选择用户筛选；
自动根据最新的“年、月”设置默认展示。

管理员功能

新增、编辑、删除工资条目；
设置（修改）管理员密码；
重置其他用户密码（仅通过“忘记密码”窗口加管理员验证）。
目录结构
该项目主要由一个单文件程序（如 main.py）组成，包含以下关键函数和类：

数据库及用户管理函数

init_db(): 初始化 SQLite 数据库
get_user(username): 根据用户名获取用户信息
register_user(username, password, is_admin=False): 注册新用户
verify_password(username, password): 验证密码
update_password(username, new_password): 更新用户密码
insert_wage_data(row_data): 插入工资数据
update_wage_data(wage_id, data_dict): 更新工资数据
delete_wage_data(wage_id): 删除工资数据
query_wages(username, is_admin, year, month, search_name, filter_user): 查询工资数据
get_all_names_from_wages(): 获取所有姓名（用于管理员筛选）
get_latest_year_month(): 获取数据库中最新的年份和月份（默认选中）。
UI 界面类

LoginWindow: 登录窗口
RegisterWindow: 注册窗口
ForgotPasswordWindow: 忘记密码窗口
EntryDialog: 用于添加/编辑工资条目的对话框
AdminChangePasswordDialog: 修改管理员密码的对话框
MainWindow: 主窗口（工资查询与管理），包括表格显示、筛选、导入、导出、增删改等功能。

环境与依赖
Python 版本：建议 Python 3.7 及以上；

第三方库：
PyQt5
pandas
bcrypt
sqlite3（Python 内置）
datetime（Python 内置）
其他内置库：sys, os
如果尚未安装所需的第三方库，可以使用 pip 进行安装，例如：

pip install PyQt5 pandas bcrypt

如何运行
确保安装好 Python 及上述依赖。
将本项目中的代码保存为 main.py（或者其他合适的名字），并与 database.db 放在同一个目录下。如果还没有 database.db 文件，程序首次运行时会自动创建。
终端或命令提示符中执行：

python main.py
首次启动后，程序会自动执行 init_db() 初始化数据库。其中会有两个默认用户：
管理员：用户名“管理员”
测试用户：用户名“testuser”，密码“123456”
登录时如果使用管理员账户，可以进行数据管理、修改密码、重置用户密码等操作；如果使用普通用户仅可查看自己名下数据。

使用方法
登录/注册/忘记密码

登录

输入用户名（中文姓名）和密码，点击“登录”。
如果用户名不存在或密码错误，会有提示弹窗。

注册

点击“注册”按钮，输入用户名、密码和确认密码。
程序中默认不允许注册用户名为“管理员”，并且若用户名已存在，会提示错误。

忘记密码

点击“忘记密码”按钮，输入需要重置密码的用户名、新密码、管理员密码。
系统会再次弹出对话框要求输入管理员用户名进行验证；管理员账号验证通过后，目标用户密码才会被重置。
主窗口操作（仅管理员可执行增删改等）
登录成功后会进入主窗口：

筛选查询

“年份筛选”和“月份筛选” 下拉框：可以选择需要查询的年、月；默认会根据数据库中最新的年份、月份进行选择。
（管理员）可以通过搜索框根据姓名模糊搜索；也可使用“用户筛选”下拉框精确筛选某个姓名。

增加条目（管理员）

点击“增加条目”，会弹出对话框要求填写工资信息；
username 与姓名保持一致（程序逻辑中会自动将 username = 姓名）。

编辑条目（管理员）

在表格中单击选中某一行后，点击“编辑选中条目”；
弹出对话框后修改信息，确认保存即可。

删除条目（管理员）

选中对应行后，点击“删除选中条目”；
系统弹窗确认后，删除该记录。

导入 Excel/CSV（管理员）

点击“导入Excel/CSV”；
选择对应文件后，系统会自动解析并将列名相匹配的字段插入数据库；
要求必备列名：["姓名", "点数", "基本奖", "CT", "CT照相摆位", "DX", "MR科研", "值班", "MG", "MR", "急诊CT", "发热", "加班费", "床旁", "急诊补助", "穿刺", "值班补助", "授权职能", "其它", "奖金总计", "绩效", "时间"]
时间列用于解析年、月（形如2024-5或2024/5 等），若无法解析则以当前系统时间为准。
导出当前页面为 PDF

点击“导出当前页面为PDF”；
在弹出的保存对话框中选择保存路径，即可生成对应的 PDF 文件；
导出的 PDF 只包含主界面中表格可见的字段（这里是除去“id”、“username”、“年”、“月”外的字段）。

修改管理员密码（管理员）

点击“修改管理员密码”；
在弹出对话框中输入新密码并确认，即可修改管理员账号的密码。

回退

点击“回退”按钮，可以返回登录界面并退出当前账号。

注意事项
username 与姓名绑定

由于系统设计，每条工资记录的 username 字段与“姓名”字段保持一致，目的是在查询时能够直接匹配当前用户，而不必单独配置。
普通用户仅能看到自己名下(username)的数据，管理员可查看全部用户的数据。

管理员账号

系统默认创建名为“管理员”的管理员账号，密码默认为“admin”；可以在程序中修改密码；
不建议删除“管理员”账户，否则将失去管理员功能。

数据库文件

默认使用 database.db 同目录存放；
如果对数据安全有较高要求，建议配合系统用户权限、网络隔离等措施保护数据库文件。

表结构

users 表用于存储用户信息；
wages 表用于存储工资信息；
如果需要扩展字段，可在初始化后修改表结构，并对应调整程序中插入、导入部分的逻辑。

常见问题
首次运行时提示 No module named PyQt5
需要先安装 PyQt5，执行：
pip install PyQt5
导入 Excel 报错 No module named openpyxl
pandas 在读取 .xlsx 文件时依赖 openpyxl，可执行：
pip install openpyxl
管理员密码忘记了怎么办？
默认账户“管理员”、初始密码为“admin”；如果已经修改过密码且遗失，需要在本地删除 database.db 后重新运行程序初始化（会丢失所有数据！）或自行修改数据库 users 表中管理员用户的 password_hash（需要熟悉 bcrypt 哈希过程）。

许可证
本项目为学习和参考用途，尚未指定具体许可证。如有需求，可自由修改并使用。

作者：李自然，联系方式：13241952350；邮箱：403778034@qq.com

如需交流或反馈，可在邮箱提交 Issue 或 PR。谢谢！